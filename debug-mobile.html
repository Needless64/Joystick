<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>üîß Debug Mobile Controller</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .status {
            background: #333;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #2d1b1b;
        }
        .success {
            border-left-color: #28a745;
            background: #1b2d1b;
        }
        .warning {
            border-left-color: #ffc107;
            background: #2d2a1b;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîß Debug Mobile Controller</h1>
    
    <div id="status" class="status">
        üîÑ Initializing debug mode...
    </div>
    
    <div>
        <button onclick="testBasicConnection()">Test Basic Connection</button>
        <button onclick="testAPIEndpoint()">Test API Endpoint</button>
        <button onclick="testSendMessage()">Test Send Message</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="log" id="debugLog"></div>

    <script>
        const statusEl = document.getElementById('status');
        const logEl = document.getElementById('debugLog');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logEl.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
            console.log(`[${type}] ${message}`);
        }
        
        function updateStatus(message, type = 'info') {
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function clearLog() {
            logEl.textContent = '';
        }
        
        // Test basic connectivity
        async function testBasicConnection() {
            log('Testing basic connectivity...');
            updateStatus('üîÑ Testing basic connectivity...', 'info');
            
            try {
                // Test if we can reach the domain
                const response = await fetch('https://joystick-delta.vercel.app/', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                log(`Basic connection: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    log('‚úÖ Basic connectivity working');
                    updateStatus('‚úÖ Basic connectivity working', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`‚ùå Basic connection failed: ${error.message}`, 'error');
                updateStatus('‚ùå Basic connection failed', 'error');
            }
        }
        
        // Test API endpoint specifically
        async function testAPIEndpoint() {
            log('Testing API endpoint...');
            updateStatus('üîÑ Testing API endpoint...', 'info');
            
            try {
                const url = 'https://joystick-delta.vercel.app/api/events?role=mobile';
                log(`Fetching: ${url}`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors'
                });
                
                log(`API Response: ${response.status} ${response.statusText}`);
                log(`Response headers: ${JSON.stringify([...response.headers.entries()])}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                log(`API Data: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success) {
                    log('‚úÖ API endpoint working correctly');
                    updateStatus('‚úÖ API endpoint working', 'success');
                } else {
                    throw new Error('API returned success: false');
                }
                
            } catch (error) {
                log(`‚ùå API endpoint failed: ${error.message}`, 'error');
                log(`Error details: ${error.stack}`, 'error');
                updateStatus('‚ùå API endpoint failed', 'error');
            }
        }
        
        // Test sending a message
        async function testSendMessage() {
            log('Testing message sending...');
            updateStatus('üîÑ Testing message sending...', 'info');
            
            try {
                const url = 'https://joystick-delta.vercel.app/api/events?role=mobile';
                const testMessage = {
                    message: {
                        type: 'test',
                        data: 'Debug test message',
                        timestamp: Date.now()
                    }
                };
                
                log(`Sending to: ${url}`);
                log(`Message: ${JSON.stringify(testMessage, null, 2)}`);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testMessage),
                    mode: 'cors'
                });
                
                log(`Send Response: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                log(`Send Result: ${JSON.stringify(result, null, 2)}`);
                
                if (result.success) {
                    log('‚úÖ Message sending working correctly');
                    updateStatus('‚úÖ Message sending working', 'success');
                } else {
                    throw new Error(`Send failed: ${result.error || 'Unknown error'}`);
                }
                
            } catch (error) {
                log(`‚ùå Message sending failed: ${error.message}`, 'error');
                log(`Error details: ${error.stack}`, 'error');
                updateStatus('‚ùå Message sending failed', 'error');
            }
        }
        
        // Auto-run tests on load
        window.addEventListener('load', () => {
            log('üîß Debug mode initialized');
            log(`Current URL: ${window.location.href}`);
            log(`User Agent: ${navigator.userAgent}`);
            log(`Online: ${navigator.onLine}`);
            
            // Run basic tests automatically
            setTimeout(testBasicConnection, 1000);
            setTimeout(testAPIEndpoint, 3000);
        });
        
        // Log any unhandled errors
        window.addEventListener('error', (event) => {
            log(`‚ùå JavaScript Error: ${event.error.message}`, 'error');
            log(`Stack: ${event.error.stack}`, 'error');
        });
        
        // Log any unhandled promise rejections
        window.addEventListener('unhandledrejection', (event) => {
            log(`‚ùå Unhandled Promise Rejection: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>