<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .status { font-size: 24px; margin: 20px 0; }
        .log { background: #f0f0f0; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>API Connection Test</h1>
    <div class="status" id="status">Testing...</div>
    <div class="log" id="log"></div>

    <script>
        const status = document.getElementById('status');
        const log = document.getElementById('log');

        function addLog(message, isError = false) {
            const div = document.createElement('div');
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            div.className = isError ? 'error' : 'success';
            log.appendChild(div);
        }

        // Test simple API endpoint first
        addLog('Testing simple API endpoint...');
        
        fetch('/api/test')
            .then(response => {
                addLog('Test API Response status: ' + response.status);
                return response.json();
            })
            .then(data => {
                addLog('Test API Response: ' + JSON.stringify(data));
                
                // Now test the events API
                addLog('Testing events API...');
                return fetch('/api/events?role=mobile');
            })
            .then(response => {
                addLog('Events API Response status: ' + response.status);
                return response.json();
            })
            .then(data => {
                addLog('Events API Response: ' + JSON.stringify(data));
                status.textContent = 'All APIs Working!';
                status.className = 'status success';
                
                // Test POST request
                addLog('Testing POST request...');
                return fetch('/api/events?role=mobile', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: { type: 'test', data: 'hello world' }
                    })
                });
            })
            .then(response => response.json())
            .then(data => {
                addLog('POST Response: ' + JSON.stringify(data));
                status.textContent = 'All Tests Passed!';
            })
            .catch(error => {
                addLog('Error: ' + error.message, true);
                status.textContent = 'API Error!';
                status.className = 'status error';
            });
    </script>
</body>
</html>